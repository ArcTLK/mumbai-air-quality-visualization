<!DOCTYPE html>
    <html>
        <body>
            
                <button onClick="download()">Download AQV data as CSV File</button>
            
        </body>
        <script>
            function convertToCSV(objArray) {
                var array = typeof objArray != 'object' ? JSON.parse(objArray) : objArray;
                var str = '';

                for (var i = 0; i < array.length; i++) {
                    var line = '';
                    for (var index in array[i]) {
                        if (line != '') line += ','

                        line += array[i][index];
                    }

                    str += line + '\r\n';
                }

                return str;
            }

            function exportCSVFile(headers, data, fileName) {
                if (headers) {
                    data.unshift(headers);
                }

                var jsonObject = JSON.stringify(data);

                var csv = this.convertToCSV(jsonObject);

                var exportedFilename = fileName + '.csv' || 'aqvdata.csv';

                var blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
                if (navigator.msSaveBlob) {
                    navigator.msSaveBlob(blob, exportedFilename);
                } else {
                    var link = document.createElement("a");
                    if (link.download !== undefined) {
                        var url = URL.createObjectURL(blob);
                        link.setAttribute("href", url);
                        link.setAttribute("download", exportedFilename);
                        link.style.visibility = 'hidden';
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                    }
                }
            }

        function download(){
            var headers = {
                date: 'Date',
                latitude: "Latitude",
                longitude: "Longtitude",
                chemicalA: "Chemical A",
                chemicalB: "Chemical B"
            };

            aqvdatanotFormatted = [
                {
                    date: '01-02-2021',
                    latitude: '45.8',
                    longitude: '80.2',
                    chemicalA: '30',
                    chemicalB: '22'
                },
                {
                    date: '02-02-2121',
                    latitude: '46.3',
                    longitude: '67',
                    chemicalA: '18',
                    chemicalB: '29'
                }
            ];

            var aqvdataFormatted = [];

            aqvdatanotFormatted.forEach((data) => {
                aqvdataFormatted.push({
                    date: data.date,  
                    latitude: data.latitude,
                    longitude: data.longitude,
                    chemicalA: data.chemicalA,
                    chemicalB: data.chemicalB
                });
            });

            var fileName = 'Mumbai M ward AQV data';

            exportCSVFile(headers, aqvdataFormatted, fileName);
        }
        </script>
    </html>